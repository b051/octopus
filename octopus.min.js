/* Octopus v0.0.2 | (c) 2011-2013 by Rex Sheng */
!function(){var a,b,c,d,e,f,Parse,g,h,i,j,k,l,m,n,o,p,q,r=[].indexOf||function(a){for(var b=0,c=this.length;c>b;b++)if(b in this&&this[b]===a)return b;return-1};Parse="undefined"!=typeof require&&null!==require?require("parse").Parse:window.Parse,Parse.initialize("FPijVqDF5EAKrkGuFv1oj43Au7kOFguvoQgwt6Bp","l3EnH19I64YJC6q59v4A7fjZJ3bWJryyk5x8IWrm"),("undefined"==typeof j||null===j)&&(j=window),j.User=Parse.User,j.Union=Parse.Object.extend({className:"Union"}),j.Instrument=Parse.Object.extend({className:"Instrument"}),b=j.Message=Parse.Object.extend({className:"Message"}),j.MessageCollection=Parse.Collection.extend({model:b}),App.Zh_CN={},App.translate=App.Zh_CN,$.template=function(a){return _.template($("#"+a).html())},App.Buffer={commands:[],add:function(a){var b,c;return b=this.commands,b.push(a),1===this.commands.length&&a(c),c=function(){return b.shift(),b.length?b[0](c):void 0}}},$.fn.extend({textNodes:function(){var a;return a=/^\s*$/,this.contents().filter(function(){return this.nodeType===Node.TEXT_NODE&&!a.test(this.nodeValue)})},i18n:function(){return $("*",this).textNodes().each(function(){return this.data=App.translate[this.data]||this.data}),$("input",this).attr("placeholder",function(a,b){return App.translate[b]||b}),this}}),App.Alert=function(){function a(){}return a.displayValidationErrors=function(a){var b,c;for(b in a)c=a[b],this.addValidationError(b,c);return this.show("Warning!","Fix validation errors and try again","alert-warning")},a.addValidationError=function(a,b){var c;return c=$("input[name="+a+"]").parents(".control-group"),c.addClass("error"),$(".help-inline",c).html(b),$(".help-block",c).html(b)},a.removeValidationError=function(a){var b;return b=$("input[name="+a+"]").parents(".control-group"),b.removeClass("error"),$(".help-inline",b).html(""),$(".help-block",b).html("")},a.show=function(a,b){var c;return null==b&&(b=$("body")),c=$("<div>",{"class":"alert"}).append($("<button>",{"class":"close","data-dismiss":"alert",type:"button",html:"&times;"}),a),console.log(c,a),c.appendTo(b)},a.hide=function(){return $(".help-inline").html(""),$(".help-block").html(""),$(".error").removeClass("error"),$(".alert").hide()},a}(),App.Router=Parse.Router.extend({routes:{"":"home",login:"login",logout:"logout",signup:"signup",analytics:"analytics",instruments:"instruments","instruments/add":"newInstrument","instrument/:cid":"instrument",calendar:"calendar",account:"account","account/:tab":"account"},initialize:function(){var a=this;return this.navbar=new App.NavBar,this.sidebar=new App.SideBar,this.navbar.render(),this.sidebar.render(),Parse.history.on("route",function(){return a.sidebar.update()})},requireLogin:function(a){var b;return Parse.User.current()?(this._switchToLogin(!1),this.navbar.render(),this.content=a(),this._switchMain(this.content.el),this.content.render(),"analytics"===Parse.history.fragment?$("#main-stats").show():$("#main-stats").slideUp()):(b=Parse.history.fragment,"login"!==b&&"signup"!==b?app.navigate("login",!0):void 0)},_switchMain:function(a){return $("#pad-wrapper").empty().append(a)},_switchToLogin:function(a){return $("html")[a?"addClass":"removeClass"]("login-bg"),$("#sidebar-nav, .navbar, #pad-wrapper")[a?"hide":"show"](),$(".header")[a?"show":"hide"](),$(".login-wrapper").remove(),this.sidebar.update()},login:function(){return this._switchToLogin(!0),new App.LoginView},logout:function(){return Parse.User.logOut(),this.navbar.render(),app.navigate("",!0)},signup:function(){return this._switchToLogin(!0),new App.SignupView},home:function(){return this.requireLogin(function(){return Parse.User.current().fetch(),new App.InstrumentsTableView})},account:function(a){return this.requireLogin(function(){return new App.AccountView(a)})},calendar:function(){return this.requireLogin(function(){return new App.CalendarView})},analytics:function(){return this.requireLogin(function(){return $("#main-stats").html((new App.StatsView).el),new App.ChartsView})},instruments:function(){return this.requireLogin(function(){return new App.InstrumentsTableView})},newInstrument:function(){return this.requireLogin(function(){return new App.InstrumentView})},instrument:function(a){return this.requireLogin(function(){return new App.InstrumentView(a)})}}),App.CalendarView=Parse.View.extend({className:"row-fluid calendar-wrapper",template:$.template("content-calendar"),initialize:function(){},render:function(){var a,b,c,d,e;return this.$el.html(this.template({})),b=new Date,a=b.getDate(),c=b.getMonth(),e=b.getFullYear(),this.calendar=this.$(".calendar"),this.fullCalendar=this.calendar.fullCalendar.bind(this.calendar),d={header:{left:"month,agendaWeek,agendaDay",center:"title",right:"today prev,next"},selectable:!0,selectHelper:!0,editable:!0,events:[{title:"All Day Event",start:new Date(e,c,1)},{title:"Long Event",start:new Date(e,c,a-5),end:new Date(e,c,a-2)},{id:999,title:"Repeating Event",start:new Date(e,c,a-3,16,0),allDay:!1},{title:"Lunch",start:new Date(e,c,a,12,0),end:new Date(e,c,a,14,0),allDay:!1},{title:"Click for Google",start:new Date(e,c,28),end:new Date(e,c,29),url:"http://google.com/"}],eventBackgroundColor:"#278ccf"},this.fullCalendar(d),this},events:{"click .popup .close-pop":"closeEvent"},closeEvent:function(a){return $(a.target).parent(".new-event").fadeOut("fast")}}),App.ChartsView=Parse.View.extend({template:$.template("content-charts"),initialize:function(){},render:function(){var a,b,c,d,e,f;return this.$el.html(this.template({})),c=function(a,b,c){return $('<div id="tooltip">'+c+"</div>").css({position:"absolute",display:"none",top:b-30,left:a-50,color:"#fff",padding:"2px 5px","border-radius":"6px","background-color":"#000",opacity:.8}).appendTo("body").fadeIn(200)},Morris.Bar({element:"hero-bar",data:[{device:"1",sells:136},{device:"3G",sells:1037},{device:"3GS",sells:275},{device:"4",sells:380},{device:"4S",sells:655},{device:"5",sells:1571}],xkey:"device",ykeys:["sells"],labels:["Sells"],barRatio:.4,xLabelMargin:10,hideHover:"auto",barColors:["#3d88ba"]}),Morris.Donut({element:"hero-donut",data:[{label:"Direct",value:25},{label:"Referrals",value:40},{label:"Search engines",value:25},{label:"Unique visitors",value:10}],colors:["#30a1ec","#76bdee","#c4dafe"],formatter:function(a){return a+"%"}}),d=[{period:"2013-04",visits:2407,signups:660},{period:"2013-03",visits:3351,signups:729},{period:"2013-02",visits:2469,signups:1318},{period:"2013-01",visits:2246,signups:461},{period:"2012-12",visits:3171,signups:1676},{period:"2012-11",visits:2155,signups:681},{period:"2012-10",visits:1226,signups:620},{period:"2012-09",visits:2245,signups:500}],Morris.Line({element:"hero-graph",data:d,xkey:"period",xLabels:"month",ykeys:["visits","signups"],labels:["Visits","User signups"]}),Morris.Area({element:"hero-area",data:[{period:"2010 Q1",iphone:2666,ipad:null,itouch:2647},{period:"2010 Q2",iphone:2778,ipad:2294,itouch:2441},{period:"2010 Q3",iphone:4912,ipad:1969,itouch:2501},{period:"2010 Q4",iphone:3767,ipad:3597,itouch:5689},{period:"2011 Q1",iphone:6810,ipad:1914,itouch:2293},{period:"2011 Q2",iphone:5670,ipad:4293,itouch:1881},{period:"2011 Q3",iphone:4820,ipad:3795,itouch:1588},{period:"2011 Q4",iphone:15073,ipad:5967,itouch:5175},{period:"2012 Q1",iphone:10687,ipad:4460,itouch:2028},{period:"2012 Q2",iphone:8432,ipad:5713,itouch:1791}],xkey:"period",ykeys:["iphone","ipad","itouch"],labels:["iPhone","iPad","iPod Touch"],lineWidth:2,hideHover:"auto",lineColors:["#81d5d9","#a6e182","#67bdf8"]}),$(".knob").knob(),f=[[1,50],[2,40],[3,45],[4,23],[5,55],[6,65],[7,61],[8,70],[9,65],[10,75],[11,57],[12,59]],e=[[1,25],[2,50],[3,23],[4,48],[5,38],[6,40],[7,47],[8,55],[9,43],[10,50],[11,47],[12,39]],a=$.plot($("#statsChart"),[{data:f,label:"Signups"},{data:e,label:"Visits"}],{series:{lines:{show:!0,lineWidth:1,fill:!0,fillColor:{colors:[{opacity:.05},{opacity:.09}]}},points:{show:!0,lineWidth:2,radius:3},shadowSize:0,stack:!0},grid:{hoverable:!0,clickable:!0,tickColor:"#f9f9f9",borderWidth:0},legend:{labelBoxBorderColor:"#fff"},colors:["#a7b5c5","#30a0eb"],xaxis:{ticks:[[1,"JAN"],[2,"FEB"],[3,"MAR"],[4,"APR"],[5,"MAY"],[6,"JUN"],[7,"JUL"],[8,"AUG"],[9,"SEP"],[10,"OCT"],[11,"NOV"],[12,"DEC"]],font:{size:12,family:"Open Sans, Arial",variant:"small-caps",color:"#9da3a9"}},yaxis:{ticks:3,tickDecimals:0,font:{size:12,color:"#9da3a9"}}}),b=null,$("#statsChart").bind("plothover",function(a,d,e){var f,g,h;return e?b!==e.dataIndex?(b=e.dataIndex,$("#tooltip").remove(),g=e.datapoint[0].toFixed(0),h=e.datapoint[1].toFixed(0),f=e.series.xaxis.ticks[e.dataIndex].label,c(e.pageX,e.pageY,e.series.label+" of "+f+": "+h)):void 0:($("#tooltip").remove(),b=null)}),this}}),App.HomeView=Parse.View.extend({className:"row-fluid chart",template:$.template("content-home"),initialize:function(){},render:function(){var a,b,c,d,e;return this.$el.html(this.template({})),c=function(a,b,c){return $('<div id="tooltip">'+c+"</div>").css({position:"absolute",display:"none",top:b-30,left:a-50,color:"#fff",padding:"2px 5px","border-radius":"6px","background-color":"#000",opacity:.8}).appendTo("body").fadeIn(200)},e=[[1,50],[2,40],[3,45],[4,23],[5,55],[6,65],[7,61],[8,70],[9,65],[10,75],[11,57],[12,59]],d=[[1,25],[2,50],[3,23],[4,48],[5,38],[6,40],[7,47],[8,55],[9,43],[10,50],[11,47],[12,39]],a=$.plot($("#statsChart"),[{data:e,label:"Signups"},{data:d,label:"Visits"}],{series:{lines:{show:!0,lineWidth:1,fill:!0,fillColor:{colors:[{opacity:.1},{opacity:.13}]}},points:{show:!0,lineWidth:2,radius:3},shadowSize:0,stack:!0},grid:{hoverable:!0,clickable:!0,tickColor:"#f9f9f9",borderWidth:0},legend:{labelBoxBorderColor:"#fff"},colors:["#a7b5c5","#30a0eb"],xaxis:{ticks:[[1,"JAN"],[2,"FEB"],[3,"MAR"],[4,"APR"],[5,"MAY"],[6,"JUN"],[7,"JUL"],[8,"AUG"],[9,"SEP"],[10,"OCT"],[11,"NOV"],[12,"DEC"]],font:{size:12,family:"Open Sans, Arial",variant:"small-caps",color:"#697695"}},yaxis:{ticks:3,tickDecimals:0,font:{size:12,color:"#9da3a9"}}}),b=null,$("#statsChart").bind("plothover",function(a,d,e){var f,g,h;return e?b!==e.dataIndex?(b=e.dataIndex,$("#tooltip").remove(),g=e.datapoint[0].toFixed(0),h=e.datapoint[1].toFixed(0),f=e.series.xaxis.ticks[e.dataIndex].label,c(e.pageX,e.pageY,e.series.label+" of "+f+": "+h)):void 0:($("#tooltip").remove(),b=null)}),this},search:function(a){var b;return b=a.target.value,console.log(this.table),this.table.fnFilter(b,null)}}),App.StatsView=Parse.View.extend({className:"row-fluid stats-row",template:$.template("content-stats"),initialize:function(){return this.render()},render:function(){return this.$el.html(this.template({visits:2457,users:3,orders:322,sales:2340}))}}),a=Parse.Collection.extend({model:Instrument,query:new Parse.Query(Instrument)}),h=App.collection=new a,k=function(){var a,b,c,d,e,f,g;if(a=Parse.localStorage.getItem(Parse._getParsePath("instruments"))){for(e=JSON.parse(a),c=[],f=0,g=e.length;g>f;f++)d=e[f],b=new Parse.Object._create("Instrument"),b.id=d._id,delete d._id,b.set(d),b._refreshCache(),b._opSetQueue=[{}],c.push(b);return h.add(c),c.length}return 0},n=function(){var a,b,c,d,e,f;for(c=[],f=h.models,d=0,e=f.length;e>d;d++)a=f[d],b=a.toJSON(),b._id=a.id,c.push(b);return Parse.localStorage.setItem(Parse._getParsePath("instruments"),JSON.stringify(c))},g={iid:"Identity number",name:"Name",producer:"Producer",type:"Type",sn:"Serial number",group:"Group",range:"Range",scale:"Scale",state:"State",rank:"Rank",base_of_rank:"Base of rank",main_instrument:"Main instrument",parts_of_instrument:"Parts of instrument",acquisition_price:"Acquisition price",acquisition_date:"Date of acquisition",available_licenses:"Available licenses",deliverer:"Deliverer",deliverer_code:"Deliverer code",ordering_number:"Ordering number",precision:"Precision",store_price:"Store price",user_name:"Username",user_department:"Department",user_address:"Address",user_phone:"Phone",user_email:"Email",user_fax:"Fax"},m=function(a,b){var c;if(null==b&&(b=!1),!b)try{if(k())return h.fetch({success:function(){return console.log("fetched"),n()}}),"function"==typeof a?a():void 0}catch(d){c=d,console.log(c)}return console.log("reloading instruments..."),h.fetch({success:function(){return n(),"function"==typeof a?a():void 0},error:function(){return"function"==typeof a&&a(),console.log("error")}})},q=function(){var a=this;return h.isEmpty()?(this.$el.html("<h4>Loading...</h4>"),console.log("reloadData"),m(function(){return a._render()})):(console.log("_render"),this._render()),h.on("reset",this._render.bind(this))},App.InstrumentsTableView=Parse.View.extend({className:"table-wrapper",template:$.template("table-instruments"),itemTemplate:_.template('<li class="item" name="<%=name%>">              <i class="icon-reorder"></i>              <%= title %>              <input type="checkbox" <% if (checked) { %>checked<% } %> class="check">            </li>'),popUpTemplate:'<div class="pop-dialog" style="position:absolute;">      <div class="pointer">        <div class="arrow"></div>        <div class="arrow_border"></div>      </div>      <div class="body">        <div class="settings">          <a href="#" class="close-icon"><i class="icon-remove-sign"></i></a>          <ul class="items">          </ul>        </div>      </div>    </div>',initialize:function(){var a;return this.place=this.place.bind(this),a=function(a){var b;return b=$(a.target).closest(".pop-dialog"),0===b.length?this.closePopup(a):void 0},this.mousedown=a.bind(this)},events:{"keyup .search":"search","click tbody > tr":"selectInstrument","click .table-edit":"editInstrument","click .custom-columns":"openPopup"},_render:function(){var a,b,c;return console.log(arguments),null!=(b=this.table)&&b.dataTable().fnDestroy(),this.$el.html(this.template({all_fields:g,collection:h})),this.table=this.$("table.table").dataTable({bAutoWidth:!1,aoColumnDefs:[{aTargets:[0],bVisible:!1},{aTargets:[1],mRender:function(a,b,c){return"<a href='#instrument/"+c[0]+"'>"+a+"</a>"}},{aTargets:[15],mRender:function(a){var b,c,d,e;return c=new Date(a),e=c.getFullYear(),d=c.getMonth()+1,b=c.getDate(),""+d+"/"+b+"/"+e}},{aTargets:[10],mRender:function(a){var b,c,d,e,f;for(c=$("<span>",{"class":"rating"}),e=Number(a),b=f=0;5>f;b=++f)d=$("<span>",{"class":"star"}),b===e&&d.addClass("on"),c.append(d);return c[0].outerHTML}},{aTargets:[6,9],mRender:function(a){var b;return b=_.map(a.split(","),function(a){return'<span class="label label-success">'+a+"</span> "}),b.join("")}}]}),a=Object.keys(g).length+1,this.orders=function(){c=[];for(var b=0;a>=0?a>b:b>a;a>=0?b++:b--)c.push(b);return c}.apply(this),this.all_fields=Object.keys(g),this.setFields(["iid","name","producer","type","group","state","rank","acquisition_date","user_name","user_email"])},setFields:function(a){var b,c,d,e,f,h,i;for(this.fields=[],c=0,e=a.length;e>c;c++)b=a[c],this.fields.push(b);for(a=Object.keys(g),i=[],b=d=0,f=a.length;f>=0?f>d:d>f;b=f>=0?++d:--d)i.push(this.table.fnSetColumnVis(b+1,(h=a[b],r.call(this.fields,h)>=0)));return i},setOrders:function(a){var b,c,d,e,f,g,h,i;for(b=null,i=ColReorder.aoInstances,e=0,g=i.length;g>e;e++)if(d=i[e],d.s.dt.oInstance===this.table){b=d;break}for(this.orders=[],f=0,h=a.length;h>f;f++)c=a[f],this.orders.push(c);return console.log("setOrders",a),null!=b?b._fnOrderColumns(a):void 0},render:function(){return q.apply(this),this},changeTable:function(a,b){var c,d,e,f,g,h,i,j,k;if("sortstop"===a.type){for(console.log(arguments),c=b.item.attr("name"),console.log(c),h=[0],g=$(".item",this.items).map(function(){return $(this).attr("name")}),g=g.toArray(),window.new_fields=g,console.log(g),k=this.all_fields,i=0,j=k.length;j>i;i++)d=k[i],f=g.indexOf(d),h.push(f+1);return this.all_fields=g,this.setOrders(h)}return"change"===a.type?(e=[],$(".item",this.items).each(function(){return d=$(this).attr("name"),$("input",this).is(":checked")?e.push(d):void 0}),this.setFields(e)):void 0},openPopup:function(a){var b,c,d,e,f,h,i;for(a.stopPropagation(),a.preventDefault(),this.picker||(this.picker=$(this.popUpTemplate),this.picker.appendTo("body"),$(".close-icon",this.picker).on("click",this.closePopup.bind(this)),$(".items",this.picker).sortable({cursor:"move",stop:this.changeTable.bind(this)})),this.picker.addClass("is-visible"),this.items=c=this.picker.find(".items").empty(),i=this.all_fields,f=0,h=i.length;h>f;f++)d=i[f],e=g[d],b=r.call(this.fields,d)>=0,c.append(this.itemTemplate({name:d,title:e,checked:b}));return c.disableSelection(),$("input[type=checkbox]",c).on("change",this.changeTable.bind(this)),this.$(".btn-group").removeClass("open"),$(document).on("mousedown",this.mousedown),$(window).on("resize",this.place),this.place.apply(this)},closePopup:function(){return $(document).off("mousedown",this.mousedown),this.picker.removeClass("is-visible"),$(window).off("resize",this.place)},place:function(){var a,b,c;return a=this.$(".custom-columns"),c=a.offset(),b=a.outerHeight(!0),this.picker.css({top:c.top+b+10,left:c.left,width:354}),this.picker.focus()},search:function(a){var b;return b=a.target.value,this.table.fnFilter(b,null)},selectInstrument:function(a){var b,c,d,e,f;return e=a.currentTarget,d=$(e).find(".iid a").attr("href").match(/#instrument\/(.*)/),b=d[1],f=this.$el.siblings(".instrumentview"),f.length||(f=$("<div>",{"class":"instrumentview section"}),this.$el.parent().append(f)),console.log(this.$el,f),c=new App.InstrumentView(b,!0),f.html(c.el),c.render()},editInstrument:function(a){var b;return b=$(a.target).parents("tr").find("a").attr("href"),app.navigate(b,!0)},deleteInstrument:function(){}}),App.InstrumentView=Parse.View.extend({className:"row-fluid form-wrapper",template:$.template("form-instrument"),initialize:function(a,b){this.instrumentId=a,this.usetabs=b},_box:function(a){var b,c;return c=g[a],b=$("<div>",{"class":"field-box"}),b.append("<label>"+c+":</label>")},textField:function(a,b){var c,d,e,f;return null==b&&(b={}),d=this._box(a),f=b.tooltip,f&&(delete b.tooltip,$.extend(b,{"data-toggle":"tooltip","data-trigger":"focus","data-placement":"right",title:f})),c={"class":"span6 input-large inline-input",type:"text",name:a,value:this.model.get(a)},$.extend(c,b),e=$("<input>",c),f&&e.tooltip(),d.append(e)},chosenField:function(a,b,c){var d,e,f,g,h,i,j,k;for(null==b&&(b=[]),null==c&&(c={}),e=this._box(a),g=$("<select>",{"class":"chzn-select span6",name:a}),g.prop("multiple",c.multiple),g.append("<option></option>"),h=this.model.get(a),i=0,j=b.length;j>i;i++)d=b[i],f=$("<option>"),$.isArray(d)?(f.val(d[0]),f.html(d[1]),g.append("<option value='"+f[0]+"'>"+f[1]+"</option>")):(f.val(d),f.html(d)),$.isArray(h)?f.attr("selected",(k=f.val(),r.call(h,k)>=0)):f.attr("selected",f.val()===h),g.append(f);return e.append(g),e},dateField:function(a){var b,c,d;return b=this._box(a),d=$("<input>",{"class":"input-large inline-input span6 datepicker",type:"text",name:a}),c=this.model.get(a)||new Date,d.datepicker().on("changeDate",function(){return $(this).datepicker("hide")}),d.data("datepicker").setDate(c),b.append(d)},rateField:function(a,b){var c,d,e,f,g,h;for(c=this._box(a),e=$("<span>",{"class":"rating"}),g=this.model.get(a),d=h=0;b>=0?b>h:h>b;d=b>=0?++h:--h)f=$("<span>",{"class":"star"}),d===g&&f.addClass("on"),e.append(f);return c.append(e)},currencyField:function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;for(c=this._box(a),e=$("<div>",{"class":"input-prepend input-append span6 currency"}),h=null!=(n=this.model.get(a))?n.match(/(.)(\d+)(\.\d+)/):void 0,k=$("<div>",{"class":"btn-group"}),d=$('<button class="btn dropdown-toggle" data-toggle="dropdown"></button>'),j=$("<ul>",{"class":"dropdown-menu"}),l=0,m=b.length;m>l;l++)i=b[l],j.append($("<li>").append($("<a>",{href:"#",html:i})));return k.append(d,j),g=$("<input>",{"class":"input-large span8 text-right",type:"text",name:a}),f=$("<span>",{"class":"add-on"}),e.append(k,g,f),h&&(d.html(h[1]),g.val(h[2]),f.html(h[3])),c.append(e)},events:{"click .currency a":"changeCurrency","click .star":"clickStar","click .delete":"deleteInstrument","click .save":"save"},_render:function(){var a,b;if(this.instrumentId){if(this.model=h.get(this.instrumentId),!this.model)return app.navigate("",!0)}else this.model=new Instrument;return this.$el.html(this.template({model:this.model,usetab:this.usetabs})),a=this.$(".basic-data"),a.append(this.textField("iid",{tooltip:"Instrument identify number"})),a.append(this.textField("name",{tooltip:"Instrument name"})),a.append(this.textField("producer")),a.append(this.textField("sn")),a.append(this.textField("range")),a.append(this.textField("scale")),a.append(this.textField("precision")),a.append(this.chosenField("group",["auditing instrument","not auditing intr.","etalon","dummy"])),a.append(this.chosenField("state",["closed","lost","wasted","repairing","may use","destroyed","calibrated over","is calibrating","discharged","reserve"],{multiple:!0})),a.append(this.rateField("rank",5)),a.append(this.textField("base_of_rank")),a.append(this.textField("main_instrument")),a.append(this.textField("parts_of_instrument")),b=this.$(".instrument-user"),b.append(this.textField("deliverer")),b.append(this.textField("deliverer_code")),b.append(this.textField("ordering_number")),b.append(this.textField("available_licenses")),b.append(this.currencyField("acquisition_price",["$","¥"])),b.append(this.currencyField("store_price",["$","¥"])),b.append(this.dateField("acquisition_date")),b.append(this.textField("user_name")),b.append(this.textField("user_department")),b.append(this.textField("user_address")),b.append(this.textField("user_phone")),b.append(this.textField("user_fax")),b.append(this.textField("user_email",{type:"email"})),this.$(".chzn-select").chosen()},render:function(){return this.instrumentId?q.apply(this):this._render(),this},clickStar:function(a){var b;return b=$(a.target),b.siblings().removeClass("on"),b.addClass("on")},changeCurrency:function(a){var b,c;return a.preventDefault(),b=$(a.target),c=b.text(),b.parents(".currency").find("button").html(c)},deleteInstrument:function(){},save:function(a){var b,c=this;return a.preventDefault(),$(a.target).attr("disabled",!0).html("Saving..."),this.model.set("rank",this.$(".rating .star").index(this.$(".rating .on"))),this.$(".field-box > input, .field-box > select").each(function(a,b){var d,e;return e=b.name,e?(d=$(b),d.hasClass("datepicker")?c.model.set(e,d.data("datepicker").getDate()):c.model.set(e,d.val())):void 0}),this.$(".currency").each(function(a,b){var d,e,f,g,h;return d=$(b),e=$("button",d).text(),f=$(".add-on",d).text(),g=$("input",d),h=e+g.val()+f,c.model.set(g.attr("name"),h)}),b=new Parse.ACL,b.setRoleWriteAccess("octopus",!0),b.setRoleReadAccess("octopus",!0),this.model.setACL(b),this.model.save({success:function(){return console.log("saved!"),$(a.target).html("Saved!").removeClass("primary").addClass("success"),setTimeout(function(){return $(a.target).html("Save").attr("disabled",!1).removeClass("success").addClass("primary",200)},2e3)},error:function(b){return $(a.target).html("Save").attr("disabled",!1),console.error(b)}})}}),App.SignupView=Parse.View.extend({className:"row-fluid login-wrapper",initialize:function(){return this.user=new Parse.User,this.render()},template:_.template($("#content-signup").html()),render:function(){return this.$el.html(this.template()).i18n().appendTo($("body")),this},events:{"submit form":"onSubmit","click .login":"onSubmit"},alert:function(a){return App.Alert.show(a,this.$(".alert-wrapper").empty())},onSubmit:function(a){var b,c,d,e=this;return a.preventDefault(),a.stopPropagation(),b=this.$("input[name=email]").val(),d=this.$("input[name=confirm_password]").val(),c=this.$("input[name=password]").val(),d!==c?this.alert("<b>Warning!</b> password does not match"):(this.user.set("username",b),this.user.set("email",b),this.user.set("password",c),this.user.set("first_name",this.$("input[name=first_name]").val()),this.user.set("last_name",this.$("input[name=last_name]").val()),this.user.signUp(null,{success:function(){return app.navigate("instruments",!0)},error:function(a,b){return e.alert("<b>Warning!</b> "+b.message)}}))}}),App.LoginView=Parse.View.extend({className:"row-fluid login-wrapper",template:_.template($("#content-login").html()),initialize:function(){return this.user=new Parse.User,this.render()},render:function(){return this.$el.html(this.template()).appendTo($("body")),this},events:{"submit form":"onSubmit","click .login":"onSubmit"},alert:function(a){return App.Alert.show(a,this.$(".alert-wrapper").empty())},onSubmit:function(a){var b=this;return a.stopPropagation(),a.preventDefault(),this.user.set("username",this.$("input[name=username]").val()),this.user.set("password",this.$("input[name=password]").val()),this.user.isValid()?this.user.logIn({success:function(){return app.navigate("instruments",!0)},error:function(a,c){return b.alert("<b>Warning!</b> "+c.message)}}):$.msgbox(this.user.validationError)}}),i=$.template("widget-dropdown"),l=function(a){return new Date((new Date).getTime()-1e3*60*a)},p=function(a){var b,c,d,e;return e=new Date,_.isDate(a)||(a=new Date(a.iso)),b=e.getTime()-a.getTime(),864e5>b?(d=Math.floor(b/6e4),c=Math.floor(d/60),d-=60*c,c?""+c+" hours":""+d+" mins"):a.toLocaleDateString()},o=function(a){return a.stopPropagation(),a.preventDefault()},App.NavBar=Parse.View.extend({el:$(".nav"),initialize:function(){return this.render()},render:function(){var a;return Parse.User.current()?(a=i({text:Parse.User.current().get("username"),items:[["account","Personal info"],["account/settings","Account settings"],["export","Export your data"],"",["logout","Logout"]]}),this.searchForm=new f,this.notifications=new e,this.messagesDropdown=new c,this.$el.empty().append(this.searchForm.el,this.notifications.el,this.messagesDropdown.el,a)):this.$el.empty()}}),d=Parse.View.extend({tagName:"li",className:"notification-dropdown hidden-phone",events:{"click .pop-dialog":o,"click .pop-dialog .close-icon":"closeMenu","click .trigger":"openMenu"},initialize:function(){return $("body").click(this.closeMenu.bind(this)),this.render(),this.dialog=this.$(".pop-dialog"),this.trigger=this.$(".trigger")},closeMenu:function(a){return"close-icon"===a.target.className&&o(a),this.dialog.removeClass("is-visible"),this.trigger.removeClass("active")},openMenu:function(a){return o(a),$(".notification-dropdown .pop-dialog").removeClass("is-visible"),$(".notification-dropdown .trigger").removeClass("active"),this.dialog.toggleClass("is-visible"),this.dialog.hasClass("is-visible")?this.trigger.addClass("avtive"):this.trigger.removeClass("active")}}),c=d.extend({template:$.template("navbar-notification"),messageTemplate:$.template("widget-message"),render:function(){var a;return this.$el.html(this.template({icon:"icon-envelope-alt",type:"messages"})),a=new MessageCollection,a.add([{title:"Alejandra Galván",detail:"There are many variations of available, but the majority have suffered alterations.",thumbnail:"img/contact-img.png",time:l(48)},{title:"Alejandra Galván",detail:"There are many variations of available, have suffered alterations.",thumbnail:"img/contact-img2.png",time:l(26)},{title:"Alejandra Galván",detail:"There are many variations of available, but the majority have suffered alterations.",thumbnail:"img/contact-img.png",time:l(13)}]),a.each(this.addMessage.bind(this)),this.$(".count").html(a.length?a.length:""),this},addMessage:function(a){var b;return b=this.messageTemplate(_.extend(a.toJSON(),{timeElapse:p})),this.$(".messages").prepend(b)}}),e=d.extend({template:$.template("navbar-notification"),notificationTemplate:$.template("widget-notification"),render:function(){var a;return this.$el.html(this.template({icon:"icon-warning-sign",type:"notifications"})),this.$(".notifications").prepend('<h3>You have <span class="count"></span> new notifications</h3>'),a=[{type:"signin",content:"New user registration",time:l(13)},{type:"signin",content:"New user registration",time:l(18)},{type:"envelope-alt",content:"New message from Alejandra",time:l(28)},{type:"download-alt",content:"New order placed",time:l(1440)}],_.each(a,this.addNotification.bind(this)),this.$(".count").html(a.length?a.length:""),this},addNotification:function(a){var b;return b=this.notificationTemplate(_.extend(a,{timeElapse:p})),this.$(".notifications .footer").before(b)}}),f=Parse.View.extend({tagName:"li",className:"hidden-phone",initialize:function(){return this.render()},template:$.template("navbar-search"),render:function(){return this.$el.html(this.template({})),this}}),App.AccountView=Parse.View.extend({className:"row",template:_.template($("#content-account").html()),initialize:function(a){return this.tab=null!=a?a:"profile",this.render()},render:function(){return this.$el.html(this.template({tab:this.tab,profile:new App.EditProfileView,settings:new App.AccountSettingsView})),this},events:{"submit #edit-profile":"onSubmit","change input":"change","click .btn-cancel":"onCancel"},change:function(a){return this.attrs[a.target.id]=a.target.value},onCancel:function(a){return a.preventDefault(),app.navigate("",!0)},onSubmit:function(a){var b;return a.stopPropagation(),a.preventDefault(),b=Parse.User.current(),b.save(this.attrs,{success:function(){return app.navigate("",!0)},error:function(a,b){return $.msgbox(b.message,{type:"error"})}})}}),App.EditProfileView=Parse.View.extend({template:_.template($("#form-edit-profile").html()),initialize:function(){return this.render()},render:function(){return this.attrs=Parse.User.current().attributes,this.$el.html(this.template({user:this.attrs}))},events:function(){return{"submit form":"onSubmit","change input":"change","click .btn-cancel":"onCancel"}},change:function(a){return this.attrs[a.target.id]=a.target.value},onCancel:function(a){return a.stopPropagation(),a.preventDefault(),app.navigate("",!0)},onSubmit:function(a){var b;return a.preventDefault(),b=Parse.User.current(),b.save(this.attrs,{success:function(){return app.navigate("",!0)},error:function(a,b){return $.msgbox(b.message,{type:"error"})}})}}),App.AccountSettingsView=Parse.View.extend({template:_.template($("#form-account-settings").html()),initialize:function(){return this.render()},render:function(){return this.$el.html(this.template())}}),App.SideBar=Parse.View.extend({el:$("#dashboard-menu"),initialize:function(){return this.arrow=$("<div>",{"class":"pointer"}).append($("<div>",{"class":"arrow"}),$("<div>",{"class":"arrow_border"})),this.render()},template:$.template("sidebar-menu"),render:function(){return this.$el.html(this.template({}))},events:{"click .dropdown-toggle":"toggleSubmenu"},toggleSubmenu:function(a){var b,c;return a.preventDefault(),c=$(a.currentTarget),b=c.next("ul.submenu"),c.hasClass("active")?(c.removeClass("active"),b.slideUp("fast")):(c.addClass("active"),b.slideDown("fast"))},update:function(){var a,b,c=this;return b=Parse.history.fragment,a=function(){switch(!1){case!b.match(/^calendar/):return 1;case"analytics"!==b:return 2;case!b.match(/^users/):return 3;default:return 0}}(),this.$("> li").each(function(b,d){return b===a?$(d).addClass("active",{duration:200}).prepend(c.arrow.detach()):$(d).removeClass("active",{duration:200})})}})}.call(this);